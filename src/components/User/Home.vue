<script setup>
import { Swiper, SwiperSlide } from 'swiper/vue'
import 'swiper/css'
import 'swiper/css/navigation'
import { Navigation } from 'swiper/modules'

import useHomeLogic from '@/components/User/JS/Home.js'

// L·∫•y d·ªØ li·ªáu s·∫£n ph·∫©m
const { sanPhamMoi, sanPhamYeuThich, sanPhamXepHang } = useHomeLogic()

// Ng√†y hi·ªán t·∫°i
const now = new Date()
</script>

<template>
  <div class="container-fluid px-0">

    <!-- üåü S·∫¢N PH·∫®M M·ªöI -->
    <div class="my-4 p-2">
      <h3 class="h5 fw-bold mb-3">S·∫¢N PH·∫®M M·ªöI</h3>
      <Swiper :slides-per-view="1" :space-between="10" :breakpoints="{
        576: { slidesPerView: 2 },
        768: { slidesPerView: 3 },
        992: { slidesPerView: 4 }
      }" navigation :modules="[Navigation]">
        <SwiperSlide v-for="sp in sanPhamMoi" :key="sp.id_sp">
          <RouterLink :to="`/sanpham/${sp.id_sp}`" class="text-decoration-none text-dark">
            <div class="card h-100 mx-1 position-relative">
              <!-- Badge Gi·∫£m gi√° -->
              <div
                class="position-absolute top-0 start-0 bg-danger text-white px-2 py-1 small"
                v-if="sp.giamgia && sp.loaigiam !== null && new Date(sp.hangiamgia) > now"
              >
                Gi·∫£m gi√°
              </div>

              <img :src="sp.anhgoc" class="card-img-top product-img" alt="·∫¢nh s·∫£n ph·∫©m" />
              <div class="card-body text-center">
                <p class="fw-bold mb-1">{{ sp.tensanpham }}</p>

                <!-- Gi√° -->
                <p class="mb-2">
                  <span
                    v-if="sp.giamgia && sp.loaigiam !== null && new Date(sp.hangiamgia) > now"
                  >
                    <span class="text-danger fw-bold me-2">
                      {{
                        sp.loaigiam === 1
                          ? (sp.dongia - sp.giamgia).toLocaleString()
                          : (sp.dongia * (1 - sp.giamgia / 100)).toLocaleString()
                      }}‚Ç´
                    </span>
                    <span class="text-muted text-decoration-line-through">
                      {{ sp.dongia.toLocaleString() }}‚Ç´
                    </span>
                  </span>
                  <span v-else class="text-danger fw-bold">
                    {{ sp.dongia.toLocaleString() }}‚Ç´
                  </span>
                </p>

                <div class="d-flex justify-content-center">
                  <div class="btn btn-primary mt-2">Mua ngay</div>
                </div>
              </div>
            </div>
          </RouterLink>
        </SwiperSlide>
      </Swiper>
    </div>

    <!-- ‚ù§Ô∏è S·∫¢N PH·∫®M Y√äU TH√çCH -->
    <div class="my-4 p-2">
      <h3 class="h5 fw-bold mb-3">S·∫¢N PH·∫®M Y√äU TH√çCH</h3>
      <Swiper :slides-per-view="1" :space-between="10" :breakpoints="{
        576: { slidesPerView: 2 },
        768: { slidesPerView: 3 },
        992: { slidesPerView: 4 }
      }" navigation :modules="[Navigation]">
        <SwiperSlide v-for="sp in sanPhamYeuThich" :key="sp.id_sp">
          <RouterLink :to="`/sanpham/${sp.id_sp}`" class="text-decoration-none text-dark">
            <div class="card h-100 mx-1 position-relative">
              <!-- Badge Gi·∫£m gi√° -->
              <div
                class="position-absolute top-0 start-0 bg-danger text-white px-2 py-1 small"
                v-if="sp.giamgia && sp.loaigiam !== null && new Date(sp.hangiamgia) > now"
              >
                Gi·∫£m gi√°
              </div>

              <img :src="sp.anhgoc" class="card-img-top product-img" alt="·∫¢nh s·∫£n ph·∫©m" />
              <div class="card-body text-center">
                <p class="fw-bold mb-1">{{ sp.tensanpham }}</p>

                <!-- Gi√° -->
                <p class="mb-2">
                  <span
                    v-if="sp.giamgia && sp.loaigiam !== null && new Date(sp.hangiamgia) > now"
                  >
                    <span class="text-danger fw-bold me-2">
                      {{
                        sp.loaigiam === 1
                          ? (sp.dongia - sp.giamgia).toLocaleString()
                          : (sp.dongia * (1 - sp.giamgia / 100)).toLocaleString()
                      }}‚Ç´
                    </span>
                    <span class="text-muted text-decoration-line-through">
                      {{ sp.dongia.toLocaleString() }}‚Ç´
                    </span>
                  </span>
                  <span v-else class="text-danger fw-bold">
                    {{ sp.dongia.toLocaleString() }}‚Ç´
                  </span>
                </p>

                <div class="d-flex justify-content-center">
                  <div class="btn btn-primary mt-2">Mua ngay</div>
                </div>
              </div>
            </div>
          </RouterLink>
        </SwiperSlide>
      </Swiper>
    </div>

    <!-- üí∏ S·∫¢N PH·∫®M GI·∫¢M GI√Å -->
    <div class="my-4 p-2">
      <h3 class="h5 fw-bold mb-3">S·∫¢N PH·∫®M GI·∫¢M GI√Å</h3>
      <Swiper :slides-per-view="1" :space-between="10" :breakpoints="{
        576: { slidesPerView: 2 },
        768: { slidesPerView: 3 },
        992: { slidesPerView: 4 }
      }" navigation :modules="[Navigation]">
        <SwiperSlide v-for="sp in sanPhamXepHang" :key="sp.id_sp">
          <RouterLink :to="`/sanpham/${sp.id_sp}`" class="text-decoration-none text-dark">
            <div class="card h-100 mx-1 position-relative">
              <!-- Badge Gi·∫£m gi√° -->
              <div
                class="position-absolute top-0 start-0 bg-danger text-white px-2 py-1 small"
                v-if="sp.giamgia && sp.loaigiam !== null && new Date(sp.hangiamgia) > now"
              >
                Gi·∫£m gi√°
              </div>

              <img :src="sp.anhgoc" class="card-img-top product-img" alt="·∫¢nh s·∫£n ph·∫©m" />
              <div class="card-body text-center">
                <p class="fw-bold mb-1">{{ sp.tensanpham }}</p>

                <!-- Gi√° -->
                <p class="mb-2">
                  <span
                    v-if="sp.giamgia && sp.loaigiam !== null && new Date(sp.hangiamgia) > now"
                  >
                    <span class="text-danger fw-bold me-2">
                      {{
                        sp.loaigiam === 1
                          ? (sp.dongia - sp.giamgia).toLocaleString()
                          : (sp.dongia * (1 - sp.giamgia / 100)).toLocaleString()
                      }}‚Ç´
                    </span>
                    <span class="text-muted text-decoration-line-through">
                      {{ sp.dongia.toLocaleString() }}‚Ç´
                    </span>
                  </span>
                  <span v-else class="text-danger fw-bold">
                    {{ sp.dongia.toLocaleString() }}‚Ç´
                  </span>
                </p>

                <div class="d-flex justify-content-center">
                  <div class="btn btn-primary mt-2">Mua ngay</div>
                </div>
              </div>
            </div>
          </RouterLink>
        </SwiperSlide>
      </Swiper>
    </div>

  </div>
</template>

<style scoped>
.product-img {
  width: 100%;
  aspect-ratio: 1/1;
  object-fit: contain;
  padding: 10px;
}
</style>
