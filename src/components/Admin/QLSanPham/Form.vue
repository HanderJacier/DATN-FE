<template>
  <div class="container-fluid py-4">
    <h5 class="form-title mb-3 bg-warning text-dark fw-bold px-3 py-2 rounded-2 d-inline-block">
      QU·∫¢N L√ù S·∫¢N PH·∫®M
    </h5>

    <form @submit.prevent="submitForm">
      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label">T√™n s·∫£n ph·∫©m</label>
          <input type="text" v-model="productForm.tensanpham" class="form-control" />
        </div>
        <div class="col-md-4">
          <label class="form-label">Gi√° (VND)</label>
          <input type="number" v-model="productForm.dongia" class="form-control" />
        </div>
        <div class="col-md-4">
          <label class="form-label">Th∆∞∆°ng hi·ªáu</label>
          <input type="text" v-model="productForm.thuonghieuTen" class="form-control" />
        </div>

        <div class="col-md-4">
          <label class="form-label">Lo·∫°i</label>
          <input type="text" v-model="productForm.loaiTen" class="form-control" />
        </div>
        <div class="col-md-4">
          <label class="form-label">M√†u s·∫Øc</label>
          <input type="text" v-model="productForm.mausac" class="form-control" />
        </div>
        <div class="col-md-4">
          <label class="form-label">Gi·∫£m gi√° (%)</label>
          <input type="number" v-model="productForm.giamgia" class="form-control" />
        </div>

        <div class="col-md-4">
          <label class="form-label">H·∫°n gi·∫£m gi√°</label>
          <input type="date" v-model="productForm.hangiamgia" class="form-control" />
        </div>
        <div class="col-md-4">
          <label class="form-label">Ng√†y t·∫°o</label>
          <input type="date" v-model="productForm.ngaytao" class="form-control" />
        </div>

        <div class="col-md-4">
          <label class="form-label">RAM</label>
          <input type="text" v-model="productForm.ram" class="form-control" />
        </div>
        <div class="col-md-4">
          <label class="form-label">ROM</label>
          <input type="text" v-model="productForm.rom" class="form-control" />
        </div>
        <div class="col-md-4">
          <label class="form-label">M√†n h√¨nh</label>
          <input type="text" v-model="productForm.screen" class="form-control" />
        </div>
        <div class="col-md-4">
          <label class="form-label">S·ªë l∆∞·ª£ng</label>
          <input type="number" v-model="productForm.soluong" class="form-control" />
        </div>

        <!-- CPU -->
        <div class="col-md-4">
          <label class="form-label">CPU Brand</label>
          <input type="text" v-model="productForm.cpuBrand" class="form-control" />
        </div>
        <div class="col-md-4">
          <label class="form-label">CPU Model</label>
          <input type="text" v-model="productForm.cpuModel" class="form-control" />
        </div>
        <div class="col-md-4">
          <label class="form-label">CPU Type</label>
          <input type="text" v-model="productForm.cpuType" class="form-control" />
        </div>
        <div class="col-md-4">
          <label class="form-label">CPU Min Speed</label>
          <input type="text" v-model="productForm.cpuMinSpeed" class="form-control" />
        </div>
        <div class="col-md-4">
          <label class="form-label">CPU Max Speed</label>
          <input type="text" v-model="productForm.cpuMaxSpeed" class="form-control" />
        </div>
        <div class="col-md-4">
          <label class="form-label">CPU Cores</label>
          <input type="text" v-model="productForm.cpuCores" class="form-control" />
        </div>
        <div class="col-md-4">
          <label class="form-label">CPU Threads</label>
          <input type="text" v-model="productForm.cpuThreads" class="form-control" />
        </div>
        <div class="col-md-4">
          <label class="form-label">CPU Cache</label>
          <input type="text" v-model="productForm.cpuCache" class="form-control" />
        </div>

        <!-- GPU -->
        <div class="col-md-4">
          <label class="form-label">GPU Brand</label>
          <input type="text" v-model="productForm.gpuBrand" class="form-control" />
        </div>
        <div class="col-md-4">
          <label class="form-label">GPU Model</label>
          <input type="text" v-model="productForm.gpuModel" class="form-control" />
        </div>
        <div class="col-md-4">
          <label class="form-label">GPU Full Name</label>
          <input type="text" v-model="productForm.gpuFullName" class="form-control" />
        </div>
        <div class="col-md-4">
          <label class="form-label">GPU Memory</label>
          <input type="text" v-model="productForm.gpuMemory" class="form-control" />
        </div>

        <!-- ·∫¢nh -->
        <div class="col-md-4">
          <label class="form-label">·∫¢nh s·∫£n ph·∫©m</label>
          <input type="file" @change="onImageChange" class="form-control" />
        </div>

        <div v-if="productForm.diachianh" class="col-md-4">
          <label class="form-label d-block">Xem tr∆∞·ªõc ·∫£nh</label>
          <img :src="productForm.diachianh" alt="Preview" width="100" height="100" class="rounded" />
        </div>
      </div>

      <div class="mt-4 d-flex justify-content-end gap-2">
        <!-- N√∫t L√†m M·ªõi -->
        <button type="button" class="btn btn-warning" @click="handleReset">
          L√†m M·ªõi
        </button>

        <!-- N√∫t Th√™m: ch·ªâ hi·ªÉn th·ªã khi kh√¥ng s·ª≠a -->
        <button
          type="submit"
          class="btn btn-success fw-bold"
        >
          Th√™m
        </button>

        <!-- N√∫t X√≥a: ch·ªâ hi·ªÉn th·ªã khi ƒëang s·ª≠a -->
        <button
          type="button"
          class="btn btn-danger"
          @click="handleDelete"
        >
          X√≥a
        </button>

        <!-- N√∫t S·ª≠a: ch·ªâ hi·ªÉn th·ªã khi ƒëang s·ª≠a -->
        <button
          type="submit"
          class="btn btn-primary fw-bold"
        >
          S·ª≠a
        </button>
      </div>
    </form>
  </div>
</template>

<script setup>
import { ref, watch, onMounted } from 'vue'
import apiClient from '@/api' // file axios instance

const props = defineProps({
  productId: Number
})
const emit = defineEmits(['reset'])

const productForm = ref({
  tensanpham: '',
  dongia: '',
  thuonghieuTen: '',
  loaiTen: '',
  mausac: '',
  mota: '',
  diachianh: '',
  cpuBrand: '',
  cpuModel: '',
  cpuType: '',
  cpuMinSpeed: '',
  cpuMaxSpeed: '',
  cpuCores: '',
  cpuThreads: '',
  cpuCache: '',
  gpuBrand: '',
  gpuModel: '',
  gpuFullName: '',
  gpuMemory: '',
  ram: '',
  rom: '',
  screen: '',
  soluong: '',
  giamgia: '',
  loaigiamTen: '',
  hangiamgia: '',
  ngaytao: ''
})

// üîÑ Khi productId thay ƒë·ªïi, t·ª± ƒë·ªông g·ªçi API v√† g√°n v√†o form
watch(
  () => props.productId,
  async (id) => {
    if (id) {
      try {
        const res = await apiClient.get(`/san-pham/${id}`)
        productForm.value = { ...res.data }
      } catch (err) {
        console.error('L·ªói t·∫£i s·∫£n ph·∫©m:', err)
      }
    } else {
      resetForm()
    }
  },
  { immediate: true }
)

function resetForm() {
  productForm.value = {
    tensanpham: '',
    dongia: '',
    thuonghieuTen: '',
    loaiTen: '',
    mausac: '',
    mota: '',
    diachianh: '',
    cpuBrand: '',
    cpuModel: '',
    cpuType: '',
    cpuMinSpeed: '',
    cpuMaxSpeed: '',
    cpuCores: '',
    cpuThreads: '',
    cpuCache: '',
    gpuBrand: '',
    gpuModel: '',
    gpuFullName: '',
    gpuMemory: '',
    ram: '',
    rom: '',
    screen: '',
    soluong: '',
    giamgia: '',
    loaigiamTen: '',
    hangiamgia: '',
    ngaytao: ''
  }
  emit('reset')
}

function onImageChange(event) {
  const file = event.target.files[0]
  if (file) {
    const reader = new FileReader()
    reader.onload = (e) => {
      productForm.value.diachianh = e.target.result
    }
    reader.readAsDataURL(file)
  }
}
</script>
